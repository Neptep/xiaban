<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>工作倒计时</title>
    <script src="https://unpkg.com/vue@next"></script>
  </head>
  <body>
    <div id="app">
      <div class="yuki-count-down">{{getOffTimeInfo()}}</div>

      <button @click="showDiv = !showDiv">点击显示/隐藏</button>
      <div v-show="showDiv">
        <div class="yuki-holiday">
          <h1>请编辑你的法定节假日</h1>
          <ul>
            <li v-for="(item, index) in holidays" :key="index">
              <input type="text" v-model="item.date" />
              <input type="text" v-model="item.title" />
              <button @click="removeItem(holidays,index)">删除</button>
            </li>
          </ul>
          <button @click="addItem(holidays)">新增</button>
        </div>
        <div class="yuki-work-day">
          <h1>请编辑你的额外工作日</h1>
          <ul>
            <li v-for="(item, index) in workDays" :key="index">
              <input type="text" v-model="item.date" />
              <input type="text" v-model="item.title" />
              <button @click="removeItem(workDays,index)">删除</button>
            </li>
          </ul>
          <button @click="addItem(workDays)">新增</button>
        </div>

        <div class="yuki-get-off-time">
          <h1>请编辑你的下班时间</h1>
          <ul>
            <input type="text" v-model="getOffTime" />
          </ul>
        </div>
      </div>
    </div>

    <script>
      const app = Vue.createApp({
        data() {
          return {
            showDiv: false,
            holidays: [
              {
                date: '2023-04-05',
                title: '清明节(1天)',
              },
              {
                date: '2023-04-29',
                title: '劳动节(5天)',
              },
              {
                date: '2023-05-12',
                title: '《王国之泪》发售',
              },
              {
                date: '2023-06-22',
                title: '端午节(3天)',
              },
              {
                date: '2023-09-29',
                title: '中秋国庆双节(8天)',
              },
            ], // 初始化数组
            workDays: [
              //调班

              {
                date: '2023-04-23',
                title: '劳动节调班',
              },
              {
                date: '2023-05-06',
                title: '劳动节调班',
              },
              {
                date: '2023-10-07',
                title: '中秋国庆双节调班',
              },
              {
                date: '2023-10-08',
                title: '中秋国庆双节调班',
              },
              //额外加班
              {
                date: '2023-02-11',
                title: '2月月初周六加班',
              },
              {
                date: '2023-03-04',
                title: '3月月初周六加班',
              },
              {
                date: '2023-04-01',
                title: '4月月初周六加班',
              },
              {
                date: '2023-06-03',
                title: '6月月初周六加班',
              },
              {
                date: '2023-07-01',
                title: '7月月初周六加班',
              },
              {
                date: '2023-08-05',
                title: '8月月初周六加班',
              },
              {
                date: '2023-09-02',
                title: '9月月初周六加班',
              },
              {
                date: '2023-10-14',
                title: '10月月初周六加班(预测)',
              },
              {
                date: '2023-11-04',
                title: '11月月初周六加班',
              },
              {
                date: '2023-12-02',
                title: '12月月初周六加班',
              },
            ],
            getOffTime: '18:00:00',
          };
        },
        methods: {
          addItem(data) {
            data.push('new item');
          },
          removeItem(data, index) {
            data.splice(index, 1);
          },
          getOffTimeInfo() {
            const dateObj = new Date();
            this.currentDate = dateObj.toISOString().slice(0, 10); // 将日期转换为字符串
            console.log(this.currentDate);
            this.currentTime = dateObj.toLocaleTimeString(); // 将时间转换为字符串
            console.log(this.currentTime);
            this.currentTimeStamp = new Date(
              this.currentDate + ' ' + this.currentTime
            ).getTime();

            //下班时间
            let t = this.currentDate + ' ' + this.getOffTime;
            this.timestamp = new Date(t).getTime();

            let diff = (this.timestamp - this.currentTimeStamp) / 1000;

            const dateObj2 = new Date('2023-03-30 12:00:00');
            this.timestamp = dateObj.getTime(); // 获取时间戳
            let str = '';
            if (diff < 0) {
              //已经下班
              if (diff <= -600) {
                str += '\n依然为了老板努力加班的社畜，已加班:' + -diff;
              } else {
                str += '\n下班了！！！！快润';
              }
            } else {
              str += '\n今天的工作时间剩余: ' + diff;
              if (diff > 3600) {
                let h = Math.floor(diff / 3600);
                console.log(diff - h * 3600);
                let m = Math.floor((diff - h * 3600) / 60);
                str +=
                  '\n时间： ' +
                  h +
                  ' 时 ' +
                  m +
                  ' 分 ' +
                  Math.floor(diff % 60) +
                  ' 秒';
              } else {
                str +=
                  '\n时间： ' +
                  Math.floor(diff / 60) +
                  ' 分 ' +
                  Math.floor(diff % 60) +
                  ' 秒';
              }
            }

            return str;
            // return '今天的工作时间剩余: 24236\n时间： 6 时 43 分 56 秒\n距离【清明节(1天)】6天\n距离【劳动节(5天)】30天\n 距离【《王国之泪》发售】43天\n距离【端午节(3天)】84天\n距离【中秋国庆双节(8天)】183天\n2023-04-01 , 4月月初周六加班, 你还不能放假哦\n不算当天, 距离【周末】2天';
          },
        },
      });

      app.mount('#app');
    </script>
  </body>
</html>

<style>
  .yuki-count-down {
    white-space: pre-wrap;
  }
</style>

<!-- 
PHP function

    $time = time();
    $end_time = strtotime(date('Y-m-d 18:00:00'));
    $diff = $end_time - $time;

    $content = '';

    if ($diff < 0) {
        if (($time - $end_time) >= 600) {
            $content .= ('依然为了老板努力加班的社畜，已加班:'.($time - $end_time).PHP_EOL);
        } else {
            $content .=  ('下班了！！！！'.PHP_EOL);
        }
    } else {
        $content .= ('今天的工作时间剩余: '.$diff.PHP_EOL);
        if ($diff > 3600) {
            $h = intval($diff / 3600);
            $m = intval(($diff - ($h * 3600)) / 60);
            $content .= ("时间： ". $h . ' 时 ' . $m . ' 分 ' . $diff % 60 .' 秒'.PHP_EOL);
        } else {
            $content .= ("时间： ". intval($diff / 60) . ' 分 ' . $diff % 60 .' 秒'.PHP_EOL);
        }
    }
    $day = date('Y-m-d');
    foreach ($holiday as $holi => $name) {
        if (strtotime($day) > strtotime($holi)) continue;
        $diffDay = (strtotime($holi) - strtotime($day)) / 3600 / 24;
        if ($diffDay == 0) {
            $content .= (PHP_EOL."【不会吧不会吧，今天是".$name."，你还在上班？？？】".PHP_EOL.PHP_EOL);
        } else {
            $content .= ('距离【'.$name.'】'.$diffDay.'天'.PHP_EOL);
        }
    }

    // 获取周末时间
    $week = date('w') == 0 ? 7 : date('w');
    $saturday_time = strtotime('today +' . (7 - $week) . 'day -1 second');
    $saturday = date('Y-m-d',$saturday_time);
    $saturday_time = strtotime($saturday);
    $diffSatDay = ($saturday_time - strtotime($day)) / 3600 / 24;
    $diffSatDay--;// 不算今天
    if (array_key_exists($saturday, $workDays)) {
        $content .= ($saturday.' , '.$workDays[$saturday].', 你还不能放假哦');
        $diffSatDay++;
    }
    $content .= ('不算当天, 距离【周末】'.$diffSatDay.'天'.PHP_EOL);


 -->
